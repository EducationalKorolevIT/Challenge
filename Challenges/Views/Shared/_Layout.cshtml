<!DOCTYPE html>

@{
    Challenges.Models.Users user = (Challenges.Models.Users)Session["User"] ?? new Challenges.Models.Users();
    if (user.Nickname == null) { user.Nickname = user.Login; }
    ViewBag.User = user;
    ViewBag.IsAuthorized = Session["User"] != null;
    ViewBag.IsAvatarExist = File.Exists(HttpContext.Current.Server.MapPath("~/Files/Avatars/" + user.Id + ".jpg"));
    ViewBag.Reputation = user.Reputation;

    ViewBag.HighestReputationList = Challenges.Models.SharedObjects.database.Users.ToList();
    ViewBag.HighestReputationList.Sort(new Challenges.Models.SharedObjects.BoxLengthFirst());

    List<Challenges.Models.Users> outd = new List<Challenges.Models.Users>();

    for(int i=0;i < (ViewBag.HighestReputationList.Count>10 ? 10: ViewBag.HighestReputationList.Count); i++)
    {
        outd.Add(ViewBag.HighestReputationList[i]);
    }

    ViewBag.HighestReputationList = outd;
}

<html lang="ru">
<head>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="/Files/GetCssFile?fileString=Content/main.css">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css2?family=Kaushan+Script&f..">

    <link href="/Files/GetCssFile?fileString=Content/bxslider/jquery.bxslider.css" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
    <script src="/Files/GetJsFile?fileString=Content/bxslider/jquery.bxslider.min.js"></script>
    <script src="/Files/GetJsFile?fileString=Content/bxslider/jquery.easing.1.3.js"></script>
    <script src="/Files/GetJsFile?fileString=Content/bxslider/jquery.fitvids.js"></script>
    <script src="/Files/GetJsFile?fileString=Content/main.js"></script>

    <title>
        Главная
    </title>

</head>

<body>
    <div class="menu">
        <h1 class="logo">Logo</h1>
        <nav class="nav">
            <a class="nav_link" href="/Home/Index">  <img src="/Files/GetJpgFile?fileString=Content/css/house_main.PNG">Главная</a>
            <a class="nav_link" href="/Home/CompetitorsIncoming">   <img src="/Files/GetJpgFile?fileString=Content/css/devil(2).png">Соперники</a>
            <a class="nav_link" href="#search">  <img src="/Files/GetJpgFile?fileString=Content/css/loupe.png"><div class="hiding_elems_left"> Поиск</div></a>
            <a class="nav_link" href="/Home/Notifications">  <img src="/Files/GetJpgFile?fileString=Content/css/bell.png">Уведомления</a>
            <a class="nav_link" href="/Home/Messanges">  <img src="/Files/GetJpgFile?fileString=Content/css/message.png">Сообщения</a>
            <a class="nav_link" href="#save">  <img src="/Files/GetJpgFile?fileString=Content/css/bookmark.png">Сохранённое</a>
            @if (ViewBag.IsAuthorized)
            {
                <a class="nav_link" href="/Auth/Profile">
                    @if (ViewBag.IsAvatarExist)
                    {
                        <img src="/Files/GetAvatar" height="32" style="border-radius: 24px; margin-top: 8px;" />
                    }@ViewBag.User.Nickname
                    <p style="font-size: 8px">Репутация: @ViewBag.Reputation</p>
                </a>
            }
            else
            {
                <button class="nav_link" onclick="window.open('/Auth/Main','_blank')">  <img src="/Files/GetJpgFile?fileString=Content/css/user.png"> Войти</button>
            }
            <a class="nav_link" href="#customization">  <img src="/Files/GetJpgFile?fileString=Content/css/settings.png"> Настройки</a>
        </nav>

        @if (ViewBag.IsAuthorized)
        {
            <button onclick="window.location.href='/Files/UploadChallengePage'" class="button-download"><img style="height: 30px; width: 30px; " src="/Files/GetJpgFile?fileString=Content/css/download.png"> <span>Загрузить</span> </button>
        }
    </div>

    <div class="content">
        <button class="button-open-hide-menu" onclick="closeOpenMenu();"><span class="arrow_menu"><</span></button>
        <button class="button-hide-open-topics" onclick="closeOpenTopics();"><span class="arrow_topics">></span></button>
        @RenderBody()
    </div>



    <div class="topics">
        <h2 class="topics_title">Актуальные темы</h2>
        <nav class="topics_nav">
            <a class="topics_link" href="#topics_link">какие</a>
            <a class="topics_link" href="#topics_link">темы</a>
            <a class="topics_link" href="#topics_link">????????????</a>
        </nav>

        <h2 class="topics_title">Человеки с высшей репутацией</h2>
        <nav class="topics_nav">
            @foreach(Challenges.Models.Users rep in ViewBag.HighestReputationList)
            {
                <span>@(rep.Nickname??rep.Login)</span><br />
            }
        </nav>
    </div>

    <script src="/Files/GetJsFile?fileString=Content/main.js"></script>

    <div id="profile" class="popup">
        <div class="popup_body">
            <div class="popup_content">
                <button class="button-close-popup">X</button>
                <div class="popup_title">Присоединяйся к Challenge прямо сейчас!</div>
                <div class="popup_text">Блалалала</div>
            </div>
        </div>
    </div>

</body>
</html>